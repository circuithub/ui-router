/**
 * State-based routing for AngularJS
 * @version v0.0.2-dev-2013-07-30
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b,c){"use strict";function d(a,b){return u(new(u(function(){},{prototype:a})),b)}function e(a){return t(arguments,function(b){b!==a&&t(b,function(b,c){a.hasOwnProperty(c)||(a[c]=b)})}),a}function f(a,b,c){this.fromConfig=function(a,b,c){return o(a.template)?this.fromString(a.template,b):o(a.templateUrl)?this.fromUrl(a.templateUrl,b):o(a.templateProvider)?this.fromProvider(a.templateProvider,b,c):null},this.fromString=function(a,b){return p(a)?a(b):a},this.fromUrl=function(c,d){return p(c)&&(c=c(d)),null==c?null:a.get(c,{cache:b}).then(function(a){return a.data})},this.fromProvider=function(a,b,d){return c.invoke(a,null,d||{params:b})}}function g(a){function b(b){if(!/^\w+$/.test(b))throw new Error("Invalid parameter name '"+b+"' in pattern '"+a+"'");if(f[b])throw new Error("Duplicate parameter name '"+b+"' in pattern '"+a+"'");f[b]=!0,j.push(b)}function c(a){return a.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")}var d,e=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,f={},g="^",h=0,i=this.segments=[],j=this.params=[];this.source=a;for(var k,l,m;(d=e.exec(a))&&(k=d[2]||d[3],l=d[4]||("*"==d[1]?".*":"[^/]*"),m=a.substring(h,d.index),!(m.indexOf("?")>=0));)g+=c(m)+"("+l+")",b(k),i.push(m),h=e.lastIndex;m=a.substring(h);var n=m.indexOf("?");if(n>=0){var o=this.sourceSearch=m.substring(n);m=m.substring(0,n),this.sourcePath=a.substring(0,h+n),t(o.substring(1).split(/[&?]/),b)}else this.sourcePath=a,this.sourceSearch="";g+=c(m)+"$",i.push(m),this.regexp=new RegExp(g),this.prefix=i[0]}function h(){this.compile=function(a){return new g(a)},this.isMatcher=function(a){return a instanceof g},this.$get=function(){return this}}function i(a){function b(a){var b=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(a.source);return null!=b?b[1].replace(/\\(.)/g,"$1"):""}function c(a,b){return a.replace(/\$(\$|\d{1,2})/,function(a,c){return b["$"===c?0:Number(c)]})}function d(a,b,c){if(!c)return!1;var d=a.invoke(b,b,{$match:c});return o(d)?d:!0}var e=[],f=null;this.rule=function(a){if(!p(a))throw new Error("'rule' must be a function");return e.push(a),this},this.otherwise=function(a){if(q(a)){var b=a;a=function(){return b}}else if(!p(a))throw new Error("'rule' must be a function");return f=a,this},this.when=function(e,f){var g,h;if(q(e)&&(e=a.compile(e)),a.isMatcher(e)){if(q(f))h=a.compile(f),f=["$match",function(a){return h.format(a)}];else if(!p(f)&&!s(f))throw new Error("invalid 'handler' in when()");g=function(a,b){return d(a,f,e.exec(b.path(),b.search()))},g.prefix=q(e.prefix)?e.prefix:""}else{if(!(e instanceof RegExp))throw new Error("invalid 'what' in when()");if(q(f))h=f,f=["$match",function(a){return c(h,a)}];else if(!p(f)&&!s(f))throw new Error("invalid 'handler' in when()");if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");g=function(a,b){return d(a,f,e.exec(b.path()))},g.prefix=b(e)}return this.rule(g)},this.$get=["$location","$rootScope","$injector",function(a,b,c){function d(){var b,d,f=e.length;for(b=0;f>b;b++)if(d=e[b](c,a)){q(d)&&a.replace().url(d);break}}return f&&e.push(f),b.$on("$locationChangeSuccess",d),{}}]}function j(a,c,f){function g(a){var b;if(q(a)){if(b=m[a],!b)throw new Error("No such state '"+a+"'")}else if(b=m[a.name],!b||b!==a&&b.self!==a)throw new Error("Invalid or unregistered state");return b}function h(e){e=d(e,{self:e,toString:function(){return this.name}});var f=e.name;if(!q(f)||f.indexOf("@")>=0)throw new Error("State must have a valid name");if(m[f])throw new Error("State '"+f+"'' is already defined");var h=k;if(o(e.parent))null!=e.parent&&(h=g(e.parent));else{var i=/^(.+)\.[^.]+$/.exec(f);null!=i&&(h=g(i[1]))}e.parent=h,e.parent&&e.parent.data&&(e.data=b.extend({},e.parent.data,e.data),e.self.data=e.data);var j=e.url;if(q(j))j=e.url="^"==j.charAt(0)?c.compile(j.substring(1)):(h.navigable||k).url.concat(j);else if(r(j)&&p(j.exec)&&p(j.format)&&p(j.concat));else if(null!=j)throw new Error("Invalid url '"+j+"' in state '"+e+"'");e.navigable=j?e:h?h.navigable:null;var n=e.params;if(n){if(!s(n))throw new Error("Invalid params in state '"+e+"'");if(j)throw new Error("Both params and url specicified in state '"+e+"'")}else n=e.params=j?j.parameters():e.parent.params;var v={};if(t(n,function(a){v[a]=!0}),h){t(h.params,function(a){if(!v[a])throw new Error("Missing required parameter '"+a+"' in state '"+f+"'");v[a]=!1});var w=e.ownParams=[];t(v,function(a,b){a&&w.push(b)})}else e.ownParams=n;var x={};t(o(e.views)?e.views:{"":e},function(a,b){b.indexOf("@")<0&&(b=b+"@"+e.parent.name),x[b]=a}),e.views=x,e.path=h?h.path.concat(e):[];var y=e.includes=h?u({},h.includes):{};return y[f]=!0,e.resolve||(e.resolve={}),!e["abstract"]&&j&&a.when(j,["$match",function(a){l.$current.navigable!=e&&l.transitionTo(e,a,!1)}]),m[f]=e,e}function i(a,b){return r(a)?b=a:b.name=a,h(b),this}function j(a,b,c,h,i,j){function m(a,d,f,g,i){function j(c,d){t(c,function(c,e){l.push(b.when(q(c)?h.get(c):h.invoke(c,a.self,m)).then(function(a){d[e]=a}))})}var k,l=[g];f?k=d:(k={},t(a.params,function(a){k[a]=d[a]}));var m={$stateParams:k},n=i.globals={$stateParams:k};return j(a.resolve,n),n.$$state=a,t(a.views,function(d,e){var f=i[e]={$$controller:d.controller};l.push(b.when(c.fromConfig(d,k,m)||"").then(function(a){f.$template=a})),d.resolve!==a.resolve&&j(d.resolve,f)}),b.all(l).then(function(b){return e(i.globals,b[0].globals),t(a.views,function(a,b){e(i[b],i.globals)}),i})}function n(a,b){var c={};return t(a,function(a){var d=b[a];c[a]=null!=d?String(d):null}),c}function p(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(a[e]!=b[e])return!1}return!0}var r=b.reject(new Error("transition superseded")),s=b.reject(new Error("transition prevented"));return l={params:{},current:k.self,$current:k,transition:null},l.transitionTo=function(c,e,f){if(o(f)||(f=!0),c=g(c),c["abstract"])throw new Error("Cannot transition to abstract state '"+c+"'");var q,t,u=c.path,w=l.$current,x=l.params,y=w.path,z=k.locals,A=[];for(q=0,t=u[q];t&&t===y[q]&&p(e,x,t.ownParams);q++,t=u[q])z=A[q]=t.locals;if(c===w&&z===w.locals)return l.transition=null,b.when(l.current);if(e=n(c.params,e||{}),a.$broadcast("$stateChangeStart",c.self,e,w.self,x).defaultPrevented)return s;for(var B=b.when(z),C=q;C<u.length;C++,t=u[C])z=A[C]=d(z),B=m(t,e,t===c,B,z);var D=l.transition=B.then(function(){var b,d,g;if(l.transition!==D)return r;for(b=y.length-1;b>=q;b--)g=y[b],g.self.onExit&&h.invoke(g.self.onExit,g.self,g.locals.globals),g.locals=null;for(b=q;b<u.length;b++)d=u[b],d.locals=A[b],d.self.onEnter&&h.invoke(d.self.onEnter,d.self,d.locals.globals);l.$current=c,l.current=c.self,l.params=e,v(l.params,i),l.transition=null;var k=c.navigable;return f&&k&&j.url(k.url.format(k.locals.globals.$stateParams)),a.$broadcast("$stateChangeSuccess",c.self,e,w.self,x),l.current},function(d){return l.transition!==D?r:(l.transition=null,a.$broadcast("$stateChangeError",c.self,e,w.self,x,d),b.reject(d))});return D},l.is=function(a){return l.$current===g(a)},l.includes=function(a){return l.$current.includes[g(a).name]},l.href=function(a,b,c){c=u({lossy:!0},c||{});var d=g(a),e=d&&c.lossy?d.navigable:d,h=e&&e.url?e.url.format(n(d.params,b||{})):null;return!f.html5Mode()&&h?"#"+h:h},l}var k,l,m={};k=h({name:"",url:"^",views:null,"abstract":!0}),k.locals={globals:{$stateParams:{}}},k.navigable=null,this.state=i,this.$get=j,j.$inject=["$rootScope","$q","$templateFactory","$injector","$stateParams","$location","$urlRouter"]}function k(a,c,d,e,f){var g;try{g=e.get("$animator")}catch(h){}var i={restrict:"ECA",terminal:!0,transclude:!0,compile:function(e,h,j){return function(e,h,k){function l(g){var i=a.$current&&a.$current.locals[p];if(i!==n)if(r&&g?r.leave(h.contents(),h):h.html(""),m&&(m.$destroy(),m=null),i){n=i,t.state=i.$$state;var k;r&&g?(k=b.element("<div></div>").html(i.$template).contents(),r.enter(k,h)):(h.html(i.$template),k=h.contents());var l=c(k);if(m=e.$new(),i.$$controller){i.$scope=m;var o=d(i.$$controller,i);h.children().data("$ngControllerController",o)}l(m),m.$emit("$viewContentLoaded"),m.$eval(q),f()}else{n=null,t.state=null;var s=j(e);r&&g?r.enter(s,h):h.append(s)}}var m,n,p=k[i.name]||k.name||"",q=k.onload||"",r=o(g)&&g(e,k);h.append(j(e));var s=h.parent().inheritedData("$uiView");p.indexOf("@")<0&&(p=p+"@"+(s?s.state.name:""));var t={name:p,state:null};h.data("$uiView",t),e.$on("$stateChangeSuccess",function(){l(!0)}),l(!1)}}};return i}function l(a){var b=a.match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function m(a){return{restrict:"A",link:function(b,c,d){var e=l(d.uiSref),f=null,g="FORM"===c[0].nodeName,h=g?"action":"href",i=!0,j=function(b){if(b&&(f=b),i){var d=a.href(e.state,f,{lossy:!0});return d?(c[0][h]=d,void 0):(i=!1,!1)}};e.paramExpr&&(b.$watch(e.paramExpr,function(a,b){a!==b&&j(a)},!0),f=b.$eval(e.paramExpr)),j(),g||c.bind("click",function(c){1!=c.which||c.ctrlKey||c.metaKey||c.shiftKey||(a.transitionTo(e.state,f),b.$apply(),c.preventDefault())})}}}function n(a,b){function e(a){this.locals=a.locals.globals,this.params=this.locals.$stateParams}function f(){this.locals=null,this.params=null}function g(c,g){if(null!=g.redirectTo){var h,j=g.redirectTo;if(q(j))h=j;else{if(!p(j))throw new Error("Invalid 'redirectTo' in when()");h=function(a,b){return j(a,b.path(),b.search())}}b.when(c,h)}else a.state(d(g,{parent:null,name:"route:"+encodeURIComponent(c),url:c,onEnter:e,onExit:f}));return i.push(g),this}function h(a,b,d){function e(a){return""!==a.name?a:c}var f={routes:i,params:d,current:c};return b.$on("$stateChangeStart",function(a,c,d,f){b.$broadcast("$routeChangeStart",e(c),e(f))}),b.$on("$stateChangeSuccess",function(a,c,d,g){f.current=e(c),b.$broadcast("$routeChangeSuccess",e(c),e(g)),v(d,f.params)}),b.$on("$stateChangeError",function(a,c,d,f,g,h){b.$broadcast("$routeChangeError",e(c),e(f),h)}),f}var i=[];e.$inject=["$$state"],this.when=g,this.$get=h,h.$inject=["$state","$rootScope","$routeParams"]}var o=b.isDefined,p=b.isFunction,q=b.isString,r=b.isObject,s=b.isArray,t=b.forEach,u=b.extend,v=b.copy;b.module("ui.util",["ng"]),b.module("ui.router",["ui.util"]),b.module("ui.state",["ui.router","ui.util"]),b.module("ui.compat",["ui.state"]),f.$inject=["$http","$templateCache","$injector"],b.module("ui.util").service("$templateFactory",f),g.prototype.concat=function(a){return new g(this.sourcePath+a+this.sourceSearch)},g.prototype.toString=function(){return this.source},g.prototype.exec=function(a,b){var c=this.regexp.exec(a);if(!c)return null;var d,e=this.params,f=e.length,g=this.segments.length-1,h={};if(g!==c.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(d=0;g>d;d++)h[e[d]]=c[d+1];for(;f>d;d++)h[e[d]]=b[e[d]];return h},g.prototype.parameters=function(){return this.params},g.prototype.format=function(a){var b=this.segments,c=this.params;if(!a)return b.join("");var d,e,f,g=b.length-1,h=c.length,i=b[0];for(d=0;g>d;d++)f=a[c[d]],null!=f&&(i+=encodeURIComponent(f)),i+=b[d+1];for(;h>d;d++)f=a[c[d]],null!=f&&(i+=(e?"&":"?")+c[d]+"="+encodeURIComponent(f),e=!0);return i},b.module("ui.util").provider("$urlMatcherFactory",h),i.$inject=["$urlMatcherFactoryProvider"],b.module("ui.router").provider("$urlRouter",i),j.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider"],b.module("ui.state").value("$stateParams",{}).provider("$state",j),k.$inject=["$state","$compile","$controller","$injector","$anchorScroll"],b.module("ui.state").directive("uiView",k),m.$inject=["$state"],b.module("ui.state").directive("uiSref",m),n.$inject=["$stateProvider","$urlRouterProvider"],b.module("ui.compat").provider("$route",n).directive("ngView",k)}(window,window.angular);